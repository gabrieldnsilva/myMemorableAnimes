<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title><%= title %></title>

		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
			rel="stylesheet"
		/>

		<link rel="stylesheet" href="/css/output.css" />
		<link rel="icon" href="/images/icons/fav-icon.webp" />

		<script
			defer
			src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
		></script>
		<script src="https://unpkg.com/htmx.org@1.9.10"></script>
	</head>
	<body class="bg-black text-white min-h-screen flex flex-col font-sans">
		<%- include('../partials/header') %> <%-
		include('../partials/flashMessages') %>

		<main id="main-content" class="flex-grow">
			<!-- Background Image -->
			<div class="absolute inset-0 -z-10">
				<img
					src="/images/backgrounds/<%= anime.backgroundImage %>"
					alt="Background <%= anime.title %>"
					class="w-full h-full object-cover opacity-40"
				/>
				<div
					class="absolute inset-0 bg-gradient-to-b from-transparent via-black/60 to-black"
				></div>
			</div>

			<div class="container mx-auto px-4 py-12">
				<!-- Breadcrumb -->
				<nav class="mb-8 text-sm">
					<ol class="flex items-center gap-2 text-gray-400">
						<li>
							<a href="/" class="hover:text-white transition"
								>In√≠cio</a
							>
						</li>
						<li>‚Ä∫</li>
						<li class="text-white"><%= anime.title %></li>
					</ol>
				</nav>

				<!-- Main Content -->
				<div class="max-w-7xl mx-auto">
					<div class="flex flex-col lg:flex-row gap-8 lg:gap-12">
						<!-- Left Column: Poster + Quick Actions -->
						<div class="lg:w-1/3 flex-shrink-0">
							<div class="sticky top-4">
								<!-- Poster -->
								<div
									class="relative rounded-2xl overflow-hidden shadow-2xl mb-6 group"
								>
									<img
										src="/images/posters/<%= anime.poster || 'default-poster.svg' %>"
										alt="<%= anime.title %>"
										class="w-full h-auto object-cover group-hover:scale-105 transition-transform duration-300"
									/>
									<!-- Title Overlay -->
									<div
										class="absolute bottom-0 inset-x-0 h-40 bg-gradient-to-t from-black via-black/70 to-transparent flex items-end justify-center pb-6 px-4"
									>
										<img
											src="/images/titles/<%= anime.backgroundImage.replace('background', 'title') %>"
											alt="<%= anime.title %>"
											class="max-h-24 w-auto object-contain drop-shadow-2xl"
											onerror="this.style.display='none'"
										/>
									</div>
								</div>

								<!-- Quick Actions -->
								<div class="space-y-3">
									<% if (typeof user !== 'undefined' && user)
									{ %>
									<button
										hx-post="/api/animes/<%= anime.id %>/add/htmx"
										hx-target="#flash-messages"
										hx-swap="beforeend"
										class="w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition transform hover:scale-105"
									>
										‚ûï Adicionar √† Minha Lista
									</button>
									<button
										hx-patch="/api/animes/<%= anime.id %>/favorite/htmx"
										hx-target="this"
										hx-swap="outerHTML"
										class="w-full px-6 py-3 border-2 border-red-500 hover:bg-red-500/10 text-white font-bold rounded-lg transition"
									>
										‚ù§Ô∏è Favoritar
									</button>
									<% } else { %>
									<a
										href="/login"
										class="block w-full text-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition"
									>
										üîê Fazer Login para Interagir
									</a>
									<% } %>
									<a
										href="/search?q=<%= anime.title %>"
										class="block w-full text-center px-6 py-3 border-2 border-white/30 hover:bg-white/10 text-white font-bold rounded-lg transition"
									>
										üîç Buscar Similar
									</a>
								</div>

								<!-- Metadata Cards -->
								<div
									class="mt-6 space-y-3 bg-white/5 backdrop-blur-lg rounded-xl p-4 border border-white/10"
								>
									<div
										class="flex justify-between items-center"
									>
										<span class="text-gray-400 text-sm"
											>G√™nero</span
										>
										<span class="text-white font-semibold"
											><%= anime.genre %></span
										>
									</div>
									<div
										class="flex justify-between items-center"
									>
										<span class="text-gray-400 text-sm"
											>Ano</span
										>
										<span class="text-white font-semibold"
											><%= anime.year %></span
										>
									</div>
									<div
										class="flex justify-between items-center"
									>
										<span class="text-gray-400 text-sm"
											>Dura√ß√£o</span
										>
										<span class="text-white font-semibold"
											><%= anime.duration %></span
										>
									</div>
									<div
										class="flex justify-between items-center"
									>
										<span class="text-gray-400 text-sm"
											>Classifica√ß√£o</span
										>
										<span class="text-white font-semibold"
											><%= anime.rating %></span
										>
									</div>
								</div>
							</div>
						</div>

						<!-- Right Column: Details -->
						<div class="lg:w-2/3">
							<!-- Title -->
							<h1
								class="text-4xl lg:text-5xl font-bold text-white mb-6"
							>
								<%= anime.title %>
							</h1>

							<!-- Badges -->
							<div class="flex flex-wrap gap-3 mb-8">
								<span
									class="px-4 py-2 bg-white/10 hover:bg-white/20 transition rounded-full border border-white/20 text-sm font-semibold"
								>
									üìÖ <%= anime.year %>
								</span>
								<span
									class="px-4 py-2 bg-white/10 hover:bg-white/20 transition rounded-full border border-white/20 text-sm font-semibold"
								>
									üé≠ <%= anime.genre %>
								</span>
								<span
									class="px-4 py-2 bg-white/10 hover:bg-white/20 transition rounded-full border border-white/20 text-sm font-semibold"
								>
									‚è±Ô∏è <%= anime.duration %>
								</span>
								<span
									class="px-4 py-2 bg-white/10 hover:bg-white/20 transition rounded-full border border-white/20 text-sm font-semibold"
								>
									üîû <%= anime.rating %>
								</span>
							</div>

							<!-- Synopsis Section -->
							<div
								class="mb-8 bg-white/5 backdrop-blur-lg rounded-2xl p-6 lg:p-8 border border-white/10"
							>
								<h2
									class="text-2xl font-bold mb-4 flex items-center gap-3"
								>
									üìñ Sinopse
								</h2>
								<p
									class="text-gray-200 text-base lg:text-lg leading-relaxed"
								>
									<%= anime.synopsis || 'Sinopse n√£o dispon√≠vel para este anime.' %>
								</p>
							</div>

							<!-- Additional Info (if available from Jikan API) -->
							<% if (anime.episodes || anime.score ||
							anime.status) { %>
							<div
								class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"
							>
								<% if (anime.episodes) { %>
								<div
									class="bg-white/5 backdrop-blur-lg rounded-xl p-5 border border-white/10 text-center"
								>
									<div
										class="text-3xl font-bold text-blue-400 mb-1"
									>
										<%= anime.episodes %>
									</div>
									<div class="text-gray-400 text-sm">
										Epis√≥dios
									</div>
								</div>
								<% } %> <% if (anime.score) { %>
								<div
									class="bg-white/5 backdrop-blur-lg rounded-xl p-5 border border-white/10 text-center"
								>
									<div
										class="text-3xl font-bold text-yellow-400 mb-1"
									>
										‚≠ê <%= anime.score %>
									</div>
									<div class="text-gray-400 text-sm">
										Avalia√ß√£o
									</div>
								</div>
								<% } %> <% if (anime.status) { %>
								<div
									class="bg-white/5 backdrop-blur-lg rounded-xl p-5 border border-white/10 text-center"
								>
									<div
										class="text-lg font-bold text-green-400 mb-1"
									>
										<%= anime.status %>
									</div>
									<div class="text-gray-400 text-sm">
										Status
									</div>
								</div>
								<% } %>
							</div>
							<% } %>

							<!-- Back Button -->
							<div class="mt-8">
								<a
									href="/"
									class="inline-flex items-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 text-white font-semibold rounded-lg transition"
								>
									‚Üê Voltar ao Cat√°logo
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>

		<%- include('../partials/footer') %>
	</body>
</html>
