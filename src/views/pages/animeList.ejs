<!-- Anime List Page -->
<div class="bg-gradient-to-b from-black via-black/80 to-black/50 py-8 border-b border-white/10">
				<div class="container mx-auto px-4 max-w-7xl">
					<h1 class="text-4xl md:text-5xl font-bold">Minha Lista de Animes</h1>
					<p class="text-white/60 mt-2">
						Total: <span class="text-blue-400 font-semibold"><%= pagination ? pagination.total : (typeof animes !== 'undefined' ? animes.length : 0) %></span>
					</p>
				</div>
			</div>

			<div class="container mx-auto px-4 py-10 max-w-7xl space-y-8">
				<!-- Filtros e Ordena√ß√£o -->
				<form method="GET" class="bg-white/5 border border-white/10 rounded-xl p-6 grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
					<div class="space-y-2">
						<label class="text-white/70">Status</label>
						<select name="status" class="w-full bg-gray-900/70 border border-white/10 rounded-lg px-3 py-2">
							<option value="">Todos</option>
							<option value="watching" <%= filters?.status === 'watching' ? 'selected' : '' %>>üëÄ Assistindo</option>
							<option value="completed" <%= filters?.status === 'completed' ? 'selected' : '' %>>‚úÖ Completo</option>
							<option value="on-hold" <%= filters?.status === 'on-hold' ? 'selected' : '' %>>‚è∏ Pausado</option>
							<option value="dropped" <%= filters?.status === 'dropped' ? 'selected' : '' %>>‚ùå Abandonado</option>
							<option value="plan-to-watch" <%= filters?.status === 'plan-to-watch' ? 'selected' : '' %>>üìã Planejado</option>
						</select>
					</div>
					<div class="space-y-2">
						<label class="text-white/70">Favoritos</label>
						<select name="favorite" class="w-full bg-gray-900/70 border border-white/10 rounded-lg px-3 py-2">
							<option value="">Todos</option>
							<option value="true" <%= filters?.favorite === true ? 'selected' : '' %>>‚ù§Ô∏è Somente favoritos</option>
							<option value="false" <%= filters?.favorite === false ? 'selected' : '' %>>ü§ç N√£o favoritos</option>
						</select>
					</div>
					<div class="space-y-2">
						<label class="text-white/70">Ordenar por</label>
						<select name="sortBy" class="w-full bg-gray-900/70 border border-white/10 rounded-lg px-3 py-2">
							<option value="addedAt" <%= filters?.sortBy === 'addedAt' ? 'selected' : '' %>>Data de adi√ß√£o</option>
							<option value="title" <%= filters?.sortBy === 'title' ? 'selected' : '' %>>T√≠tulo</option>
							<option value="rating" <%= filters?.sortBy === 'rating' ? 'selected' : '' %>>Nota</option>
						</select>
					</div>
					<div class="space-y-2">
						<label class="text-white/70">Ordem</label>
						<select name="sortOrder" class="w-full bg-gray-900/70 border border-white/10 rounded-lg px-3 py-2">
							<option value="DESC" <%= filters?.sortOrder === 'DESC' ? 'selected' : '' %>>Mais recente</option>
							<option value="ASC" <%= filters?.sortOrder === 'ASC' ? 'selected' : '' %>>Mais antigo</option>
						</select>
					</div>
					<div class="md:col-span-4 flex flex-wrap gap-3 justify-end pt-2">
						<input type="hidden" name="limit" value="<%= filters?.limit || 12 %>" />
						<button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold">Aplicar</button>
						<a href="/animes" class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg font-semibold">Limpar</a>
					</div>
				</form>

				<% if (typeof animes !== 'undefined' && animes.length > 0) { %>
					<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
						<% animes.forEach(entry => { %>
							<div class="anime-card bg-white/5 backdrop-blur-lg border border-white/10 rounded-xl overflow-hidden hover:border-blue-400/50 transition group">
								<div class="relative overflow-hidden bg-gradient-to-b from-white/10 to-black/50 aspect-square">
									<img
										src="<%= entry.anime.poster && entry.anime.poster.startsWith('http') ? entry.anime.poster : '/images/posters/' + entry.anime.poster %>"
										alt="<%= entry.anime.title %>"
										class="w-full h-full object-cover group-hover:scale-110 transition duration-300"
										onerror="this.src='/images/icons/fav-icon.webp'"
									/>
									<div class="absolute top-4 right-4 px-3 py-1 bg-blue-600/80 backdrop-blur rounded-full text-xs font-bold">
										<% 
											const statusMap = {
												'watching': 'üëÄ Assistindo',
												'completed': '‚úÖ Completo',
												'on-hold': '‚è∏ Pausado',
												'dropped': '‚ùå Abandonado',
												'plan-to-watch': 'üìã Planejado',
												'plan_to_watch': 'üìã Planejado',
											};
										%>
										<%= statusMap[entry.status] || entry.status %>
									</div>
									<button
										hx-patch="/api/animes/<%= entry.anime.id %>/favorite/htmx"
										hx-target="this"
										hx-swap="outerHTML"
										class="absolute top-4 left-4 text-2xl"
										title="Favoritar"
									>
										<%= entry.isFavorite ? '‚ù§Ô∏è' : 'ü§ç' %>
									</button>
								</div>

								<div class="p-6 space-y-4">
									<div>
										<h3 class="text-xl font-bold line-clamp-2 group-hover:text-blue-400 transition"><%= entry.anime.title %></h3>
										<p class="text-sm text-white/50 mt-1">
											<%= entry.anime.year %> ‚Ä¢ <%= entry.anime.genre %>
										</p>
									</div>

									<div class="flex items-center justify-between py-2 border-t border-b border-white/10">
										<span class="text-sm text-white/60">Sua nota:</span>
										<% if (entry.rating) { %>
											<span class="text-lg font-bold text-yellow-400">
												<%= '‚≠ê'.repeat(entry.rating) %> (<%= entry.rating %>/5)
											</span>
										<% } else { %>
											<span class="text-sm text-white/40">Sem nota</span>
										<% } %>
									</div>

									<div class="space-y-2">
										<div class="flex justify-between text-sm">
											<span class="text-white/60">Progresso:</span>
											<span class="text-white/80">
												<%= entry.watchedEpisodes || 0 %>/<%= entry.anime.episodeCount || '?' %> eps
											</span>
										</div>
										<div class="w-full bg-white/10 rounded-full h-2 overflow-hidden">
											<% 
												const episodeCount = entry.anime.episodeCount || 1;
												const progress = Math.min((entry.watchedEpisodes || 0) / episodeCount * 100, 100);
											%>
											<div class="bg-gradient-to-r from-blue-500 to-purple-500 h-full rounded-full" style="width: <%= progress %>%"></div>
										</div>
									</div>

									<% if (entry.notes) { %>
										<div class="text-sm text-white/60 italic bg-white/5 p-3 rounded border-l-2 border-blue-400">"<%= entry.notes %>"</div>
									<% } %>

									<div class="flex gap-2 pt-2">
										<a
											href="/anime/<%= entry.anime.id %>"
											class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-center font-semibold transition text-sm"
										>
											Detalhes
										</a>
										<button
											hx-delete="/api/animes/<%= entry.anime.id %>/list/htmx"
											hx-target="closest .anime-card"
											hx-swap="outerHTML"
											class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition text-sm"
											title="Remover da lista"
										>
											üóëÔ∏è Remover
										</button>
									</div>

									<p class="text-xs text-white/40 text-right">
										Adicionado: <%= new Date(entry.createdAt).toLocaleDateString('pt-BR') %>
									</p>
								</div>
							</div>
						<% }); %>
					</div>

					<!-- Pagina√ß√£o -->
					<% if (pagination && pagination.totalPages > 1) { %>
					<%
						const buildQuery = (pageTarget) => {
							const params = new URLSearchParams();
							if (filters?.status) params.set('status', filters.status);
							if (filters?.favorite === true) params.set('favorite', 'true');
							if (filters?.favorite === false) params.set('favorite', 'false');
							if (filters?.sortBy) params.set('sortBy', filters.sortBy);
							if (filters?.sortOrder) params.set('sortOrder', filters.sortOrder);
							params.set('limit', String(filters?.limit || 12));
							params.set('page', String(pageTarget));
							return params.toString();
						};
						const prevPage = Math.max(1, pagination.page - 1);
						const nextPage = Math.min(pagination.totalPages, pagination.page + 1);
					%>
					<div class="flex items-center justify-between mt-8 text-sm">
						<span class="text-white/60">P√°gina <%= pagination.page %> de <%= pagination.totalPages %></span>
						<div class="flex gap-3">
							<a href="?<%= buildQuery(prevPage) %>" class="px-3 py-2 bg-white/10 rounded-lg <%= pagination.page === 1 ? 'opacity-40 pointer-events-none' : 'hover:bg-white/20' %>">Anterior</a>
							<a href="?<%= buildQuery(nextPage) %>" class="px-3 py-2 bg-white/10 rounded-lg <%= pagination.page === pagination.totalPages ? 'opacity-40 pointer-events-none' : 'hover:bg-white/20' %>">Pr√≥xima</a>
						</div>
					</div>
					<% } %>
				<% } else { %>
					<div class="text-center py-20">
						<div class="text-6xl mb-6">üì≠</div>
						<h2 class="text-3xl font-bold mb-3">Sua lista est√° vazia</h2>
						<p class="text-white/60 mb-8">Comece adicionando seus animes favoritos!</p>
						<a
							href="/search"
							class="inline-block px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition"
						>
							üîç Buscar Animes
						</a>
					</div>
				<% } %>
</div>
